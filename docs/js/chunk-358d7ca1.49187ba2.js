(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-358d7ca1"],{"5d6b":function(e,t,a){var s=a("e53d").parseInt,i=a("a1ce").trim,r=a("e692"),o=/^[-+]?0[xX]/;e.exports=8!==s(r+"08")||22!==s(r+"0x16")?function(e,t){var a=i(String(e),3);return s(a,t>>>0||(o.test(a)?16:10))}:s},7445:function(e,t,a){var s=a("63b6"),i=a("5d6b");s(s.G+s.F*(parseInt!=i),{parseInt:i})},9746:function(e,t,a){},a1ce:function(e,t,a){var s=a("63b6"),i=a("25eb"),r=a("294c"),o=a("e692"),n="["+o+"]",l="​",c=RegExp("^"+n+n+"*"),u=RegExp(n+n+"*$"),m=function(e,t,a){var i={},n=r(function(){return!!o[e]()||l[e]()!=l}),c=i[e]=n?t(p):o[e];a&&(i[a]=c),s(s.P+s.F*n,"String",i)},p=m.trim=function(e,t){return e=String(i(e)),1&t&&(e=e.replace(c,"")),2&t&&(e=e.replace(u,"")),e};e.exports=m},a21f:function(e,t,a){var s=a("584a"),i=s.JSON||(s.JSON={stringify:JSON.stringify});e.exports=function(e){return i.stringify.apply(i,arguments)}},b9e9:function(e,t,a){a("7445"),e.exports=a("584a").parseInt},bfd2:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-card",{attrs:{bordered:!1}},[this.$route.query.id?a("h2",[e._v("投票详情")]):a("h2",[e._v("新增投票")]),a("div",[a("a-form",{attrs:{form:e.form},on:{submit:e.voteSubmit}},[a("div",{directives:[{name:"show",rawName:"v-show",value:!e.nextSkip,expression:"!nextSkip"}],staticClass:"basicQuestion"},[a("a-col",{attrs:{lg:{span:14},md:{span:24}}},[a("a-form-item",{staticClass:"search-item",attrs:{label:"投票标题",labelCol:e.searchCol.labelCol,wrapperCol:e.searchCol.wrapperCol,hasFeedback:""}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["title",{rules:[{required:!0,message:"请填写标题"},{whitespace:!0,message:"请勿输入空格"}]}],expression:"['title', { rules: [{ required: true, message: '请填写标题' },{ whitespace: true, message: '请勿输入空格'}]}]"}],attrs:{placeholder:"投票标题"}})],1)],1),a("a-col",{staticClass:"search-item-col mediaModeFather",attrs:{lg:{span:13},md:{span:24}}},[a("a-form-item",{staticClass:"search-item mediaModelLeft",attrs:{label:"封面图"}},[a("a-upload",{directives:[{name:"decorator",rawName:"v-decorator",value:["headImage",{rules:[{required:!0,message:"请上传封面图"},{validator:e.validatePass}]}],expression:"['headImage', { rules: [{ required: true, message: '请上传封面图' }, {validator: validatePass}] }]"}],staticClass:"avatar-uploader",attrs:{listType:"picture-card",showUploadList:!1,action:"//jsonplaceholder.typicode.com/posts/",beforeUpload:e.beforeUpload,accept:"image/png, image/jpeg, image/jpg"}},[e.headImage?a("img",{staticClass:"img maxImg",attrs:{src:e.headImage,alt:"avatar"}}):a("div",[a("a-icon",{attrs:{type:e.loading?"loading":"plus"}}),a("div",{staticClass:"ant-upload-text"},[e._v("上传图片")])],1)])],1)],1),a("a-col",{staticClass:"contentText",attrs:{span:24}},[a("a-form-item",{attrs:{label:"正文",hasFeedback:""}},[a("editor",{ref:"editor",attrs:{tipContent:e.addText},on:{shotContent:e.getContent}})],1)],1),a("a-col",{staticClass:"search-item-col",attrs:{lg:{span:14},md:{span:24}}},[a("a-form-item",{staticClass:"search-item",attrs:{label:"投票作者",labelCol:{span:3},wrapperCol:e.searchCol.wrapperCol}},[a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["authorId",{rules:[{required:!0,message:"请选择作者"}]}],expression:"['authorId',{rules:[{required:true,message:'请选择作者'}]}]"}],attrs:{placeholder:"请选择"}},e._l(e.allAuthor,function(t){return a("a-select-option",{key:t.id},[e._v(e._s(t.name))])}),1)],1)],1),a("a-col",{staticClass:"search-item-col",attrs:{lg:{span:14},md:{span:24}}},[a("a-form-item",{staticClass:"search-item",attrs:{label:"是否推荐",labelCol:{span:3},wrapperCol:e.searchCol.wrapperCol}},[a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["recommend",{rules:[{required:!0,message:"请选择是否推荐"}]}],expression:"['recommend',{rules:[{required:true,message:'请选择是否推荐'}]}]"}],attrs:{placeholder:"请选择"}},[a("a-select-option",{attrs:{value:"1"}},[e._v("推荐")]),a("a-select-option",{attrs:{value:"0"}},[e._v("不推荐")])],1)],1)],1),a("a-col",{staticClass:"search-item-col",attrs:{lg:{span:14},md:{span:24}}},[a("a-form-item",{staticClass:"search-item",attrs:{label:"投票标签",labelCol:{span:3},wrapperCol:e.searchCol.wrapperCol}},[a("a-checkbox-group",{attrs:{options:e.tagsName},on:{change:e.onChange},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}})],1)],1),a("a-col",{staticClass:"search-item-col",attrs:{lg:{span:14},md:{span:24}}},[a("a-form-item",{staticClass:"search-item",attrs:{label:"发布时间",labelCol:e.searchCol.labelCol,wrapperCol:e.searchCol.wrapperCol}},[a("a-date-picker",{directives:[{name:"decorator",rawName:"v-decorator",value:["releaseTime"],expression:"['releaseTime']"}],attrs:{format:"YYYY-MM-DD HH:mm:ss",showTime:{defaultValue:e.moment("00:00","HH:mm")}},on:{change:e.publishTimer}})],1)],1),a("a-col",{staticClass:"search-item-col",attrs:{lg:{span:14},md:{span:24}}},[a("a-form-item",{staticClass:"search-item",attrs:{label:"截止时间",labelCol:e.searchCol.labelCol,wrapperCol:e.searchCol.wrapperCol}},[a("a-date-picker",{directives:[{name:"decorator",rawName:"v-decorator",value:["endTime",{rules:[{required:!0,message:"请选择投票截止时间"}]}],expression:"['endTime',{rules:[{required:true,message:'请选择投票截止时间'}]}]"}],attrs:{format:"YYYY-MM-DD HH:mm:ss",showTime:{defaultValue:e.moment("00:00:00","HH:mm:ss")}},on:{change:e.finishTimer}})],1)],1)],1),a("div",{directives:[{name:"show",rawName:"v-show",value:e.nextSkip,expression:"nextSkip"}],staticClass:"detailQuestion"},[a("a-col",{attrs:{lg:{span:14},md:{span:24}}},[a("a-form-item",{staticClass:"search-item",attrs:{label:"题目类型",labelCol:{span:24},wrapperCol:{span:24},hasFeedback:""}},[a("a-radio-group",{attrs:{disabled:e.scheduled},on:{change:e.changeQuestionType},model:{value:e.questionType,callback:function(t){e.questionType=t},expression:"questionType"}},[a("a-radio",{attrs:{value:1,checked:""}},[e._v("单选题")]),a("a-radio",{attrs:{value:2}},[e._v("多选题")])],1)],1)],1),a("a-col",{attrs:{lg:{span:14},md:{span:24}}},[a("a-form-item",{staticClass:"search-item",attrs:{label:"题目名称",labelCol:{span:24},wrapperCol:{span:24},hasFeedback:""}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["questionTitle",{rules:[{required:!0,message:"请填写题目标题"}]}],expression:"['questionTitle', { rules: [{ required: true, message: '请填写题目标题' }] }]"}],attrs:{placeholder:"请输入投票问题的题目",disabled:e.scheduled}})],1)],1),a("a-col",{staticClass:"questionChoose",attrs:{lg:{span:14},md:{span:24}}},[e._l(e.form.getFieldValue("keys"),function(t,s){return a("a-form-item",e._b({key:t,attrs:{label:"选项"+(s+1),required:!0,labelCol:{span:24},wrapperCol:{span:24}}},"a-form-item",0===s?e.formItemLayoutWithOutLabel:e.formItemLayout,!1),[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["content["+t+"]",{validateTrigger:["change","blur"],preserve:!0,rules:[{required:!0,whitespace:!0,message:"请输入此行投票选项"}]}],expression:"[\n                `content[${k}]`,\n                {\n                  validateTrigger: ['change', 'blur'],\n                  preserve: true,\n                  rules: [{\n                    required: true,\n                    whitespace: true,\n                    message: '请输入此行投票选项',\n                  }],\n                }\n              ]"}],staticStyle:{width:"88%","margin-right":"10px"},attrs:{placeholder:"请输入投票选项",disabled:e.scheduled}}),e.form.getFieldValue("keys").length>1?a("a-icon",{staticClass:"dynamic-delete-button",attrs:{type:"minus-circle-o",disabled:1===e.form.getFieldValue("keys").length},on:{click:function(){return e.remove(t)}}}):e._e(),e.optionImgUrlArr[t-1]&&e.optionImgUrlArr[t-1].optionImgUrl?a("img",{staticClass:"img niubiImg",attrs:{src:e.optionImgUrlArr[t-1].optionImgUrl,alt:"avatar"}}):e._e(),a("div",{staticClass:"clearfix chooseImg",on:{click:function(t){return e.optionImg(s)}}},[a("a-upload",{staticClass:"avatar-uploader",attrs:{listType:"picture-card",showUploadList:!1,action:"//jsonplaceholder.typicode.com/posts/",beforeUpload:e.beforeUploadOption,accept:"image/png, image/jpeg, image/jpg",disabled:e.scheduled}},[a("div",[a("a-icon",{attrs:{type:e.loading?"loading":"plus"}})],1)])],1)],1)}),a("a-form-item",e._b({},"a-form-item",e.formItemLayoutWithOutLabel,!1),[a("a-button",{staticStyle:{width:"60%"},attrs:{type:"dashed",disabled:e.scheduled},on:{click:e.add}},[a("a-icon",{attrs:{type:"plus"}}),e._v("\n              新增投票选项\n            ")],1)],1)],2)],1),a("a-col",{staticClass:"search-item-col",attrs:{lg:{span:24},md:{span:24}}},[a("span",{staticClass:"button-sub"},[a("a-button",{directives:[{name:"show",rawName:"v-show",value:!e.nextSkip,expression:"!nextSkip"}],staticStyle:{"margin-left":"8px"},attrs:{type:"primary",disabled:e.buttonState},on:{click:function(t){return e.next()}}},[e._v("下一步")]),a("a-button",{directives:[{name:"show",rawName:"v-show",value:e.nextSkip,expression:"nextSkip"}],staticStyle:{"margin-left":"8px"},attrs:{type:"primary",disabled:e.buttonState},on:{click:function(t){return e.preAction()}}},[e._v("上一步")]),a("a-button",{directives:[{name:"show",rawName:"v-show",value:e.nextSkip,expression:"nextSkip"}],staticStyle:{"margin-left":"8px"},attrs:{type:"primary",disabled:e.buttonState},on:{click:function(t){return e.save()}}},[e._v("保存")]),a("a-button",{directives:[{name:"show",rawName:"v-show",value:e.nextSkip,expression:"nextSkip"}],staticStyle:{"margin-left":"8px"},attrs:{type:"primary","html-type":"submit",disabled:e.buttonState}},[e._v("发布")])],1)])],1)],1)])},i=[],r=a("e814"),o=a.n(r),n=a("f499"),l=a.n(n),c=(a("a481"),a("7f7f"),a("c37f")),u=a("da05"),m=a("c1df"),p=a.n(m),d=a("9fb0"),h=a("ca00"),g=a("fac5"),f=a("3e29"),v=a("fd47"),b=a("88bc"),C=a.n(b),y=0,T=function(e,t,a){if(t&&t.file){var s="image/jpeg"===t.file.type||"image/png"===t.file.type||"image/jpg"===t.file.type;s||a(new Error("请上传JPEG,PNG,JPG图片"));var i=t.file.size/1024/1024<10;i||a(new Error("请上传小于10M的JPEG,PNG,JPG图片"))}a()},w={components:{ACol:u["b"],Editor:c["a"]},data:function(){return{tagsId:[],tagsName:[],value:[],checkedTags:!1,formItemLayout:{labelCol:{xs:{span:24},sm:{span:4}},wrapperCol:{xs:{span:24},sm:{span:20}}},formItemLayoutWithOutLabel:{wrapperCol:{xs:{span:24,offset:0},sm:{span:20,offset:4}}},richContent:null,searchCol:{labelCol:{lg:{span:3}},wrapperCol:{md:{span:12},lg:{span:12}}},previewVisible:!1,tags:[],allAuthor:[],articleType:1,nextSkip:!1,publishTime:"",publishTimeCurrent:null,finishTime:"",finishTimeCurrent:null,questionType:1,questions:[],oneVote:{},optionImgUrlArr:[],optionKey:1,optionImgUrl:"",indexKeys:null,focusTagIndex:null,options:[],optionsItem:{},addText:null,headImage:null,validatePass:T,loading:!1,releaseTime:null,endTime:null,scheduled:!1,buttonState:!1}},beforeCreate:function(){this.form=this.$form.createForm(this),this.form.getFieldDecorator("keys",{initialValue:[],preserve:!0})},watch:{optionImgUrlArr:function(){}},methods:{onChange:function(){},remove:function(e){var t=this.form,a=t.getFieldValue("keys");1!==a.length&&(t.setFieldsValue({keys:a.filter(function(t){return t!==e})}),this.optionImgUrlArr.splice(e-1,1))},add:function(){var e=this.form,t=e.getFieldValue("keys"),a=t.concat(++y);e.setFieldsValue({keys:a})},handleCancel:function(){this.previewVisible=!1},handlePreview:function(e){this.previewVisible=!1},handleChange:function(e){var t=e.fileList;this.fileList=t},optionImg:function(e){var t=this.form.getFieldValue("content"),a=e+1;this.optionKey=a;t[a]},beforeUploadOption:function(e){var t=this,a="image/jpeg"===e.type||"image/png"===e.type||"image/jpg"===e.type;a||this.$message.error("请上传JPEG,PNG,JPG图片");var s=e.size/1024/1024<5;s||this.$message.error("图像应小于5MB!"),a&&s&&(this.avatarFile=e,Object(h["c"])(this.avatarFile).then(function(e){var a=d["k"]+e.name,s={};s.optionImgUrl=a,s.key=t.optionKey,t.optionImgUrlArr.push(s),console.log(t.optionImgUrlArr)}))},beforeUpload:function(e){var t=this,a="image/jpeg"===e.type||"image/png"===e.type||"image/jpg"===e.type;return a?(this.avatarFile=e,this.loading=!0,Object(h["c"])(this.avatarFile).then(function(e){t.headImage=e.url,console.info("图片上传成功"+e),t.loading=!1}),!1):(this.headImage="",!1)},changeQuestionType:function(e){this.questionType=e.target.value},moment:p.a,publishTimer:function(e,t){this.publishTime=t},finishTimer:function(e,t){this.finishTime=t},getContent:function(e){this.richContent=e.editorContent},voteSubmit:function(e){var t=this;e.preventDefault(),this.form.validateFields(function(e,a){if(!e){for(var s=t.form.getFieldValue("content"),i=[],r=1;r<s.length;r++){var o={};o.content=s[r],o.optionNo=r,i.push(o)}var n=t.form.getFieldsValue(["questionTitle"]),l={};l.title=n.questionTitle,l.options=i,l.type=t.questionType,l.questionNo=0,l.optionImgUrl=t.optionImgUrlArr,t.questions.push(l),a.description=t.richContent,a.headImage=t.headImage,a.type=0,a.status=1,a.releaseTime=t.publishTime,a.endTime=t.finishTime,a.tagIds=t.value,a.questions=t.questions,a.staticContentUrl="123456",a.appShareUrl="654321",t.$route.query.id&&(a.id=t.$route.query.id),console.log(a),Object(v["c"])(a).then(function(e){console.log(e),!0===e.result?(alert("发布成功"),t.buttonState=!0,setTimeout(function(){t.$router.replace("/vote/list")},1e3)):alert(e.message)})}})},save:function(){var e=this,t=JSON.parse(l()(this.oneVote)),a=JSON.parse(l()(this.questions));t.content=this.form.getFieldValue("content"),console.info("content="+t.content),t.title=this.form.getFieldValue("questionTitle"),t.imgsInfo=this.optionImgUrlArr,t.type=this.questionType,t.questionNo=1,this.form.validateFields(function(s,i){if(!s){for(var r=[],n=1;n<i.content.length;n++)r.push({content:i.content[n],optionNo:n});t.options=r,a.push(t),i.authorId+="",i.recommend=o()(i.recommend),i.description=e.richContent,i.headImage=e.headImage,i.type=0,i.status=0,i.releaseTime=e.publishTime,i.endTime=e.finishTime,i.tagIds=e.value,i.questions=a,e.$route.query.id&&(i.id=e.$route.query.id),console.log("values="+l()(i)),Object(v["c"])(i).then(function(t){console.log(t),!0===t.result?(alert("保存成功"),e.buttonState=!0,setTimeout(function(){e.$router.replace("/vote/list")},1e3)):alert(t.message)})}})},changeArticleType:function(e){this.articleType=e},next:function(){var e=this;this.form.validateFields(["title","headImage","authorId","recommend","endTime"],function(t,a){t||(e.nextSkip=!0)})},preAction:function(){this.nextSkip=!1}},activated:function(){for(var e=this,t=0;t<3;t++)setTimeout(function(){e.add()},100);this.tagsName=[],this.tagsId=[],Object(g["c"])().then(function(t){e.tags=t.object;for(var a=0;a<e.tags.length;a++)e.tagsName.push(e.tags[a].name),e.tagsId.push(e.tags[a].id)}),Object(f["c"])().then(function(t){e.allAuthor=t.object}),this.$route.query.id&&Object(v["a"])(this.$route.query.id).then(function(t){console.log(t.object);var a=t.object;1!=a.scheduled&&2!=a.scheduled||(e.scheduled=!0);var s=a.tags;if(0!=s.length)for(var i=0;i<s.length;i++)e.value.push(s[i].name);e.addText=a.description,a.releaseTime=a.releaseTime?p()(a.releaseTime):null,a.endTime=a.endTime?p()(a.endTime):null,e.finishTime=a.endTime._i,a.recommend+="",a.type+="",a.authorId+="",e.headImage=a.headImage,e.questions=a.questions;for(var r=a.questions[0].title,o=a.questions[0].options,n=0;n<o.length-3;n++)setTimeout(function(){e.add()},0);for(var l=[],c=0;c<o.length;c++){l[c+1]=o[c].content;var u={};u.optionImgUrl=o[c].imageUrl,u.key=c,e.optionImgUrlArr.push(u)}setTimeout(function(){e.form.setFieldsValue({content:l,questionTitle:r})},100),e.form.setFieldsValue(C()(a,"title","authorId","releaseTime","endTime","recommend","headImage"))})}},x=w,I=(a("f873"),a("2877")),k=Object(I["a"])(x,s,i,!1,null,null,null);t["default"]=k.exports},e692:function(e,t){e.exports="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"},e814:function(e,t,a){e.exports=a("b9e9")},f499:function(e,t,a){e.exports=a("a21f")},f873:function(e,t,a){"use strict";var s=a("9746"),i=a.n(s);i.a},fd47:function(e,t,a){"use strict";a.d(t,"b",function(){return o}),a.d(t,"c",function(){return n}),a.d(t,"a",function(){return l});var s=a("b775"),i=a("9fb0"),r=i["l"];function o(e){return Object(s["b"])({url:r+"/vote/list",method:"post",data:e})}function n(e){return Object(s["b"])({url:r+"/vote/save",method:"post",data:e})}function l(e){return Object(s["b"])({url:r+"/vote/getById/"+e,method:"get"})}}}]);