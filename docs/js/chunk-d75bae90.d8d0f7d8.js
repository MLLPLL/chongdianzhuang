(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-d75bae90"],{"144a":function(e,t,s){"use strict";var a=s("4126"),i=s.n(a);i.a},4126:function(e,t,s){},"946f":function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("a-card",{attrs:{bordered:!1}},[s("h2",[e._v("新增问卷")]),s("div",[s("a-form",{attrs:{form:e.form},on:{submit:e.questionnaireSubmit}},[s("div",{directives:[{name:"show",rawName:"v-show",value:!e.nextSkip,expression:"!nextSkip"}],staticClass:"basicQuestion"},[s("a-col",{attrs:{lg:{span:14},md:{span:24}}},[s("a-form-item",{staticClass:"search-item",attrs:{label:"问卷标题",labelCol:{span:3},wrapperCol:{span:12},hasFeedback:""}},[s("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["title",{rules:[{required:!0,message:"请填写问卷标题"}]}],expression:"['title', { rules: [{ required: true, message: '请填写问卷标题' }] }]"}],attrs:{placeholder:"问卷标题"}})],1)],1),s("a-col",{staticClass:"search-item-col mediaModeFather",attrs:{lg:{span:14},md:{span:24}}},[s("a-form-item",{staticClass:"search-item mediaModelLeft",attrs:{label:"封面图"}},[s("a-upload",{directives:[{name:"decorator",rawName:"v-decorator",value:["headImage",{rules:[{required:!0,message:"请上传封面图"},{validator:e.validatePass}]}],expression:"['headImage', { rules: [{ required: true, message: '请上传封面图' }, {validator: validatePass}] }]"}],staticClass:"avatar-uploader",attrs:{listType:"picture-card",showUploadList:!1,action:"//jsonplaceholder.typicode.com/posts/",beforeUpload:e.beforeUpload,accept:"image/png, image/jpeg, image/jpg"}},[e.headImage?s("img",{staticClass:"img maxImg",attrs:{src:e.headImage,alt:"headImage"}}):s("div",[s("a-icon",{attrs:{type:e.loading?"loading":"plus"}}),s("div",{staticClass:"ant-upload-text"},[e._v("上传图片")])],1)])],1)],1),s("a-col",{staticClass:"contentText",attrs:{span:24}},[s("a-form-item",{attrs:{label:"正文",hasFeedback:""}},[s("editor",{directives:[{name:"decorator",rawName:"v-decorator",value:["description"],expression:"['description', ]"}],ref:"editor",attrs:{tipContent:e.addText},on:{shotContent:e.getContent}})],1)],1),s("a-col",{staticClass:"search-item-col",attrs:{lg:{span:14},md:{span:24}}},[s("a-form-item",{staticClass:"search-item",attrs:{label:"问卷作者",labelCol:{span:3},wrapperCol:e.searchCol.wrapperCol}},[s("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["authorId",{rules:[{required:!0,message:"请选择作者"}]}],expression:"['authorId',{rules:[{required:true,message:'请选择作者'}]}]"}],attrs:{placeholder:"请选择"}},e._l(e.allAuthor,function(t,a){return s("a-select-option",{key:a},[e._v(e._s(t.name))])}),1)],1)],1),s("a-col",{staticClass:"search-item-col",attrs:{lg:{span:14},md:{span:24}}},[s("a-form-item",{staticClass:"search-item",attrs:{label:"是否推荐",labelCol:{span:3},wrapperCol:e.searchCol.wrapperCol}},[s("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["recommend",{rules:[{required:!0,message:"请选择是否推荐"}]}],expression:"['recommend',{rules:[{required:true,message:'请选择是否推荐'}]}]"}],attrs:{placeholder:"请选择"}},[s("a-select-option",{attrs:{value:"0"}},[e._v("推荐")]),s("a-select-option",{attrs:{value:"1"}},[e._v("不推荐")])],1)],1)],1),s("a-col",{staticClass:"search-item-col",attrs:{lg:{span:14},md:{span:24}}},[s("a-form-item",{staticClass:"search-item",attrs:{label:"问卷标签",labelCol:{span:3},wrapperCol:e.searchCol.wrapperCol}},[s("a-checkbox-group",{attrs:{options:e.tagsName},on:{change:e.onChange},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}})],1)],1),s("a-col",{staticClass:"search-item-col",attrs:{lg:{span:14},md:{span:24}}},[1!=e.scheduled&&2!=e.scheduled?s("a-form-item",{staticClass:"search-item",attrs:{label:"发布时间",labelCol:e.searchCol.labelCol,wrapperCol:e.searchCol.wrapperCol}},[s("a-date-picker",{directives:[{name:"decorator",rawName:"v-decorator",value:["releaseTime"],expression:"['releaseTime']"}],attrs:{format:"YYYY-MM-DD HH:mm:ss",showTime:{defaultValue:e.moment("00:00:00","HH:mm:ss")}},on:{change:e.publishTimer}})],1):e._e()],1),s("a-col",{staticClass:"search-item-col",attrs:{lg:{span:14},md:{span:24}}},[s("a-form-item",{staticClass:"search-item",attrs:{label:"截止时间",labelCol:e.searchCol.labelCol,wrapperCol:e.searchCol.wrapperCol}},[s("a-date-picker",{directives:[{name:"decorator",rawName:"v-decorator",value:["endTime",{rules:[{required:!0,message:"请选择截止时间"}]}],expression:"['endTime',{rules:[{required:true,message:'请选择截止时间'}]}]"}],attrs:{defaultPick:"",format:"YYYY-MM-DD HH:mm:ss",showTime:{defaultValue:e.moment("00:00:00","HH:mm:ss")}},on:{change:e.finishTimer}})],1)],1)],1),s("div",{directives:[{name:"show",rawName:"v-show",value:e.nextSkip,expression:"nextSkip"}],staticClass:"detailQuestion"},[s("a-col",{attrs:{lg:{span:14},md:{span:24}}},[s("a-form-item",{staticClass:"search-item",attrs:{label:"题目类型",labelCol:{span:24},wrapperCol:{span:24},hasFeedback:""}},[s("a-radio-group",{on:{change:e.changeQuestionType},model:{value:e.questionType,callback:function(t){e.questionType=t},expression:"questionType"}},[s("a-radio",{attrs:{value:1,checked:""}},[e._v("单选题")]),s("a-radio",{attrs:{value:2}},[e._v("多选题")]),s("a-radio",{attrs:{value:3}},[e._v("简单问答")])],1)],1)],1),s("a-col",{attrs:{lg:{span:14},md:{span:24}}},[s("a-form-item",{staticClass:"search-item",attrs:{label:"题目名称",labelCol:{span:24},wrapperCol:{span:24},hasFeedback:""}},[s("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["questionTitle"],expression:"['questionTitle',]"}],attrs:{placeholder:"请填写的问题"}})],1)],1),s("a-col",{directives:[{name:"show",rawName:"v-show",value:3!=e.questionType,expression:"questionType!=3"}],staticClass:"questionChoose",attrs:{lg:{span:14},md:{span:24}}},[e._l(e.form.getFieldValue("keys"),function(t,a){return s("a-form-item",e._b({key:t,attrs:{label:"选项"+(a+1),labelCol:{span:24},wrapperCol:{span:24}}},"a-form-item",0===a?e.formItemLayoutWithOutLabel:e.formItemLayout,!1),[s("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["names["+t+"]",{validateTrigger:["change","blur"],preserve:!0,rules:[{required:!1,whitespace:!0,message:"请输入此行投票选项"}]}],expression:"[\n        `names[${k}]`,\n        {\n          validateTrigger: ['change', 'blur'],\n          preserve: true,\n          rules: [{\n            required: false,\n            whitespace: true,\n            message: '请输入此行投票选项',\n          }],\n        }\n      ]"}],staticStyle:{width:"96%","margin-right":"10px"},attrs:{placeholder:"请输入投票选项"}}),e.form.getFieldValue("keys").length>1?s("a-icon",{staticClass:"dynamic-delete-button",attrs:{type:"minus-circle-o",disabled:1===e.form.getFieldValue("keys").length},on:{click:function(){return e.remove(t)}}}):e._e()],1)}),s("a-form-item",e._b({},"a-form-item",e.formItemLayoutWithOutLabel,!1),[s("a-button",{staticStyle:{width:"26%"},attrs:{type:"dashed"},on:{click:e.add}},[s("a-icon",{attrs:{type:"plus"}}),e._v("\n              新增投票选项\n            ")],1)],1)],2),s("a-col",{staticClass:"addTest",attrs:{lg:{span:14},md:{span:24}}},[1!=e.scheduled&&2!=e.scheduled?s("a-button",{directives:[{name:"show",rawName:"v-show",value:!e.isEdit,expression:"!isEdit"}],staticStyle:{width:"30%"},attrs:{type:"primary"},on:{click:e.goAdd}},[s("a-icon",{attrs:{type:"plus"}}),e._v("\n            加入问卷\n          ")],1):e._e(),s("a-button",{directives:[{name:"show",rawName:"v-show",value:e.isEdit,expression:"isEdit"}],staticStyle:{width:"16%","margin-right":"60px"},attrs:{type:"primary"},on:{click:e.confirmFix}},[e._v("\n            修改\n          ")]),s("a-button",{directives:[{name:"show",rawName:"v-show",value:e.isEdit,expression:"isEdit"}],staticStyle:{width:"16%"},attrs:{type:"primary"},on:{click:e.cancelFix}},[e._v("\n            取消修改\n          ")])],1),s("a-col",{staticClass:"questionList",attrs:{lg:{span:14},md:{span:24}}},[s("a-table",{attrs:{columns:e.columns,dataSource:e.questions,pagination:!1},scopedSlots:e._u([{key:"name",fn:function(t){return s("a",{attrs:{href:"javascript:;"}},[e._v(e._s(t))])}},{key:"action",fn:function(t,a){return s("span",{},[1!=e.scheduled&&2!=e.scheduled?s("span",[s("a",{attrs:{href:"javascript:;"},on:{click:function(t){return e.fixQuestion(a.key)}}},[e._v("修改")]),s("a-divider",{attrs:{type:"vertical"}}),s("a",{attrs:{href:"javascript:;"},on:{click:function(t){return e.deleteQuestion(a.key)}}},[e._v("删除")])],1):s("a",{attrs:{href:"javascript:;"}},[e._v("不可操作")])])}}])},[s("span",{attrs:{slot:"customTitle"},slot:"customTitle"},[e._v("类型")])])],1)],1),s("a-col",{staticClass:"search-item-col",attrs:{lg:{span:20},md:{span:24}}},[s("span",{staticClass:"button-sub"},[s("a-button",{directives:[{name:"show",rawName:"v-show",value:!e.nextSkip,expression:"!nextSkip"}],staticStyle:{"margin-left":"8px"},attrs:{type:"primary"},on:{click:function(t){return e.next()}}},[e._v("下一步")]),s("a-button",{directives:[{name:"show",rawName:"v-show",value:e.nextSkip,expression:"nextSkip"}],staticStyle:{"margin-left":"8px"},attrs:{type:"primary"},on:{click:function(t){return e.preAction()}}},[e._v("上一步")]),s("a-button",{directives:[{name:"show",rawName:"v-show",value:e.nextSkip,expression:"nextSkip"}],staticStyle:{"margin-left":"8px"},attrs:{type:"primary"},on:{click:function(t){return e.questionnaireSave()}}},[e._v("保存")]),s("a-button",{directives:[{name:"show",rawName:"v-show",value:e.nextSkip,expression:"nextSkip"}],staticStyle:{"margin-left":"8px"},attrs:{type:"primary","html-type":"submit"}},[e._v("发布")])],1)])],1)],1)])},i=[],n=(s("7f7f"),s("5176")),r=s.n(n),o=s("c37f"),l=s("da05"),u=s("c1df"),c=s.n(u),d=(s("9fb0"),s("ca00")),m=s("fac5"),p=s("3e29"),h=s("b9cf"),f=s("88bc"),v=s.n(f),g=0,y=[{title:"类型",dataIndex:"questionnaireType",key:"questionnaireType"},{title:"问题",dataIndex:"questionTitle",key:"questionTitle"},{title:"操作",key:"action",scopedSlots:{customRender:"action"}}],b=function(e,t,s){if(t&&t.file){var a="image/jpeg"===t.file.type||"image/png"===t.file.type||"image/jpg"===t.file.type;a||s(new Error("请上传JPEG,PNG,JPG图片"))}s()},q={components:{ACol:l["b"],Editor:o["a"]},data:function(){return{validatePass:b,isEdit:!1,questions:[],columns:y,key:0,tempKey:null,formItemLayout:{labelCol:{xs:{span:24},sm:{span:4}},wrapperCol:{xs:{span:24},sm:{span:20}}},formItemLayoutWithOutLabel:{wrapperCol:{xs:{span:24,offset:0},sm:{span:20,offset:4}}},richContent:null,searchCol:{labelCol:{md:{span:3},lg:{span:3}},wrapperCol:{md:{span:12},lg:{span:12}}},previewVisible:!1,headImage:null,tags:[],allAuthor:[],articleType:1,nextSkip:!1,releaseTime:"",publishTimeCurrent:null,endTime:"",finishTimeCurrent:null,questionType:1,tagsId:[],tagsName:[],options:[],value:[],defaultValue:"",addText:null,loading:!1,scheduled:null}},beforeCreate:function(){this.form=this.$form.createForm(this),this.form.getFieldDecorator("keys",{initialValue:[],preserve:!0})},computed:{},methods:{test:function(){setTimeout(function(){location.reload()},1e3)},onChange:function(){},goAdd:function(){var e=this;if(this.key=this.questions.length,3!=this.questionType){for(var t=this.form.getFieldsValue(["questionTitle","names"]),s=t.names,a=[],i=1;i<s.length;i++){var n={};n.content=s[i],n.optionNo=i,a.push(n)}this.key=this.key+1,t.key=this.key,t.questionNo=this.key,t.title=t.questionTitle,t.type=this.questionType,t.options=a,1==this.questionType?t.questionnaireType="单选题":2==this.questionType&&(t.questionnaireType="多选题"),this.questions.push(t)}else{var r=this.form.getFieldsValue(["questionTitle"]);this.key=this.key+1,console.log(r),r.key=this.key,r.questionNo=this.key,r.title=r.questionTitle,r.type=this.questionType,r.options=[],r.questionnaireType="简答题",this.questions.push(r)}console.log(this.questions),setTimeout(function(){e.form.setFieldsValue({questionTitle:""})},0),this.form.resetFields(["names"])},deleteQuestion:function(e){for(var t=0;t<this.questions.length;t++)this.questions[t].key==e&&this.questions.splice(t,1)},fixQuestion:function(e){var t=this;this.isEdit=!0,this.tempKey=e;for(var s=0;s<this.questions.length;s++)this.questions[s].key==e&&function(){var e=t.questions[s].questionTitle,a=t.questions[s].names;console.log(a),3==t.questions[s].questionType?setTimeout(function(){t.form.setFieldsValue({questionTitle:e})},0):setTimeout(function(){t.form.setFieldsValue({questionTitle:e,names:a})},0)}()},confirmFix:function(){for(var e=this,t=this.form.getFieldsValue(["questionTitle"]),s=this.form.getFieldsValue(["names"]),a=0;a<this.questions.length;a++)this.questions[a].key==this.tempKey&&(this.questions[a]=r()(this.questions[a],t),3!=this.questions[a].questionnaireType&&(this.questions[a]=r()(this.questions[a],s)),setTimeout(function(){e.form.setFieldsValue({questionTitle:""})},0),this.form.resetFields(["names"]))},cancelFix:function(){this.isEdit=!1},remove:function(e){var t=this.form,s=t.getFieldValue("keys");1!==s.length&&t.setFieldsValue({keys:s.filter(function(t){return t!==e})})},add:function(){var e=this.form,t=e.getFieldValue("keys"),s=t.concat(++g);e.setFieldsValue({keys:s})},handleCancel:function(){this.previewVisible=!1},handlePreview:function(e){this.previewVisible=!0},handleChange:function(e){var t=e.fileList;this.fileList=t},beforeUpload:function(e){var t=this,s="image/jpeg"===e.type||"image/png"===e.type||"image/jpg"===e.type;return s?(this.avatarFile=e,this.loading=!0,Object(d["c"])(this.avatarFile).then(function(e){t.headImage=e.url,console.info("图片上传成功"+e),t.loading=!1}),!1):(this.headImage="",!1)},changeQuestionType:function(e){this.questionType=e.target.value},moment:c.a,range:function(e,t){for(var s=[],a=e;a<t;a++)s.push(a);return s},disabledDate:function(e){return this.publishTimeCurrent=e,null==this.finishTimeCurrent?e&&e<c()().endOf("day"):e&&this.finishTimeCurrent>e<c()().endOf("day")},finishDisableDate:function(e){return this.finishTimeCurrent=e,null==this.publishTimeCurrent?e&&e<c()().endOf("day"):e&&e<this.publishTimeCurrent},disabledDateTime:function(){var e=this;return{disabledHours:function(){return e.range(0,24).splice(24,24)},disabledMinutes:function(){return e.range(30,60)},disabledSeconds:function(){return[0]}}},publishTimer:function(e,t){this.releaseTime=t},finishTimer:function(e,t){this.endTime=t},getContent:function(e){this.richContent=e.editorContent},questionnaireSubmit:function(e){var t=this;e.preventDefault(),this.form.validateFields(function(e,s){e||(delete s.names,delete s.questionTitle,s.description=t.richContent,s.headImage=t.headImage,s.releaseTime=t.releaseTime,s.endTime=t.endTime,s.questions=t.questions,s.status=1,s.staticContentUrl="123456",s.appShareUrl="654321",s.tagIds=t.value,t.$route.query.id&&(s.id=t.$route.query.id),console.log(s),Object(h["b"])(s).then(function(e){console.log(e),1==e.result?(alert("发布成功"),t.$route.query.id&&window.close(),setTimeout(function(){location.reload()},1e3)):alert(e.message)}))})},questionnaireSave:function(){var e=this;this.form.validateFields(function(t,s){t||(delete s.names,delete s.questionTitle,s.description=e.richContent,s.headImage=e.headImage,s.releaseTime=e.releaseTime,s.endTime=e.endTime,s.questions=e.questions,s.status=1,s.staticContentUrl="123456",s.appShareUrl="654321",s.tagIds=e.value,e.$route.query.id&&(s.id=e.$route.query.id),console.log(s),Object(h["b"])(s).then(function(e){console.log(e),1==e.result?(alert("保存成功"),setTimeout(function(){location.reload()},1e3)):alert(e.message)}))})},changeArticleType:function(e){this.articleType=e},next:function(){this.nextSkip=!0},preAction:function(){this.nextSkip=!1}},activated:function(){for(var e=this,t=0;t<3;t++)setTimeout(function(){e.add()},100);this.$route.query.id&&setTimeout(function(){e.tagsName=[],e.tagsId=[]},0),Object(m["c"])().then(function(t){e.tags=t.object;for(var s=0;s<e.tags.length;s++)e.tagsName.push(e.tags[s].name),e.tagsId.push(e.tags[s].id)}),Object(p["c"])().then(function(t){e.allAuthor=t.object,console.log(e.allAuthor)}),this.$route.query.id&&Object(h["e"])(this.$route.query.id).then(function(t){if(1==t.result){console.log(t.object);var s=t.object;e.scheduled=s.scheduled,e.endTime=s.endTime,s.endTime=s.endTime?c()(s.endTime):null,s.releaseTime=s.releaseTime?c()(s.releaseTime):null,s.recommend+="";var a=s.tags;if(0!=a.length)for(var i=0;i<a.length;i++)e.value.push(a[i].name);e.headImage=s.headImage,e.form.setFieldsValue(v()(s,"description","title","authorId","endTime","releaseTime","recommend","headImage")),e.addText=s.description;for(var n=0;n<s.questions.length;n++)s.questions[n].key=n+1,s.questions[n].questionTitle=s.questions[n].title,1==s.questions[n].type?s.questions[n].questionnaireType="单选题":2==s.questions[n].type?s.questions[n].questionnaireType="多选题":3==s.questions[n].type&&(s.questions[n].questionnaireType="简答题");e.questions=s.questions,console.info(e.questions)}})}},T=q,C=(s("144a"),s("2877")),w=Object(C["a"])(T,a,i,!1,null,null,null);t["default"]=w.exports},b9cf:function(e,t,s){"use strict";s.d(t,"a",function(){return r}),s.d(t,"d",function(){return o}),s.d(t,"b",function(){return l}),s.d(t,"e",function(){return u}),s.d(t,"c",function(){return c});var a=s("b775"),i=s("9fb0"),n=i["l"];function r(e){return Object(a["b"])({url:n+"/inforArticle/add",method:"post",data:e})}function o(e){return Object(a["b"])({url:n+"/inforArticle/page",method:"post",data:e})}function l(e){return Object(a["b"])({url:n+"/survey/save",method:"post",data:e})}function u(e){return Object(a["b"])({url:n+"/survey/getById/"+e,method:"get"})}function c(e){return Object(a["b"])({url:n+"/inforArticle/detail?id="+e,method:"post"})}}}]);